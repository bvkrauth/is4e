# Data and sampling

This is a new chapter that will contain the last part of the
random variables chapter, and the first part of the statistics 
chapter.

::: goals
***Chapter goals***

In this chapter we will:

- Calculate and interpret the covariance and correlation coefficient of 
  two discrete random variables.
- Calculate and interpret conditional distributions and conditional
  expectations.
- Use the theory of probability and random variables to model the random
  process generating our data set.
- Apply and interpret the assumption of simple random sampling, and compare
  it to other sampling schemes.
:::

## Multiple random variables

We will often be interested in the relationship between two or more
random variables. For example, we might want to know how tax rates
are related to economic growth, or how education is related to 
income.

### Joint distributions

Let $x = x(b)$ and $y = y(b)$ be two random variables
defined in terms of the same underlying outcome $b$.
Their joint probability distribution assigns a probability
to every event that can be defined in terms of $x$ and $y$,
for example $\Pr(x = 6 \cap y = 0)$ or $\Pr(x < y)$.

This joint distribution can be fully described by the 
***joint CDF***
$$F_{x,y}(a,b) = \Pr(x \leq a \cap y \leq b)$$
It can also be described by the ***joint PDF***
$$f_{x,y}(a,b) = \begin{cases}
      \Pr(x = a \cap y = b) & \textrm{if $x$ and $y$ are discrete} \\
      \frac{\partial F_{x,y}(a,b)}{\partial a \partial b} & \textrm{if $x$ and $y$ are continuous} \\
      \end{cases}$$

The joint distribution tells you about the relationship between the
two variables as well as the characteristics of the variables themselves.
That is, we can always get the ***marginal*** distributions of the two 
individual random variables from their joint distribution:
$$F_x(a) = \Pr(x \leq a) = \Pr(x \leq a \cap y \leq \infty) = F_{x,y}(a,\infty)$$
$$F_y(b) = \Pr(y \leq n) = \Pr(x \leq \infty \cap y \leq b) = F_{x,y}(\infty,b)$$
However, it is not possible to get the joint distribution from the 
marginal distributions.

::: example
**The joint PDF in roulette**

In our roulette example, the joint PDF of $w_{red}$ and 
$w_{14}$ can be derived from the original outcome.

If $b=14$, then both red and 14 win:
  \begin{align}
    f_{red,14}(1,35) &= \Pr(w_{red}=1 \cap w_{14} = 35) \\
      &= \Pr(b \in \{14\}) = 1/37
  \end{align}
If $b \in Red$ but $b \neq 14$, then red wins but 14 loses:
  \begin{align}
    f_{red,14}(1,-1) &= \Pr(w_{red} = 1 \cap w_{14} = -1) \\
      &= \Pr\left(b \in \left\{
        \begin{gathered}
          1,3,5,7,9,12,16,18,19,21,\\
          23,25,27,30,32,34,36
        \end{gathered}\right\}\right)  \\
      &= 17/37
  \end{align}
Otherwise both red and 14 lose:
  \begin{align}
    f_{red,14}(-1,-1) &= \Pr(w_{red} = -1 \cap w_{14} = -1) \\
      &= \Pr\left(b \in \left\{
        \begin{gathered}
          0,2,4,6,7,10,11,13,15,17, \\
          20,22,24,26,28,31,33,35
        \end{gathered}\right\}\right)  \\
      &= 19/37
  \end{align}
All other values have probability zero.
:::

### Conditional distributions

Having defined joint distributions, we can now define conditional 
distributions. By the definition of a conditional probability:
$$\Pr(x \in A| y \in B) = \frac{\Pr(x \in A \cap y \in B)}{\Pr(y \in B)}$$
So we can define the conditional CDF:
  $$F_{y|x}(a,b) = \Pr(y \leq a|x=b)$$
Conditional distributions can be derived from the joint distribution,
but it isn't always easy.

::: example
**Conditional PDFs in roulette**

Let's find the conditional PDF of the payout for a bet on 
14 given the payout for a bet on red. 
  \begin{align}
    \Pr(w_{14}=-1|w_{red}=-1) &= \frac{\Pr(w_{14}=-1 \cap w_{red}=-1)}{\Pr(w_{red}=-1)} \\
      &=\frac{19/37}{19/37} = 1 \\
  \Pr(w_{14}=35|w_{red}=-1) &= \frac{\Pr(w_{14}=35 \cap w_{red}=-1)}{\Pr(w_{red}=-1)} \\
    &=\frac{0}{19/37} = 0 \\
  \Pr(w_{14}=-1|w_{red}=1) &= \frac{\Pr(w_{14}=-1 \cap w_{red}=1)}{\Pr(w_{red}=1)} \\
    &= \frac{17/37}{18/37} \approx 0.944 \\
  \Pr(w_{14}=35|w_{red}=1) &= \frac{\Pr(w_{14}=35 \cap w_{red}=1)}{\Pr(w_{red}=1)} \\
    &= \frac{1/37}{18/37} \approx 0.056
  \end{align}
:::

### Independence

We say that $x$ and $y$ are ***independent*** if every event defined in 
terms of $x$ is independent of every event defined in terms of $y$.
  $$\Pr(x \in A \cap y \in B) = \Pr(x \in A)\Pr(y \in B)$$
Independence allows us to write all joint and conditional probabilities
in terms of marginal probabilities:
  $$F_{x,y}(a,b) = F_x(a)F_y(b)$$
  $$F_{y|x}(a,b) = F_y(a)$$
As with independence of events, this will be very handy in simplifying the
analysis.  But remember: independence is an *assumption* that
we can only make when it's reasonable to do so.

::: example
**Independence in roulette**

The winnings from a bet on red ($w_{red}$) and the winnings from 
a bet on 14 ($w_{14}$) in the same game are *not* independent. However
the winnings from a bet on red and a bet on 14 in two different 
games *are* independent since the underlying outcomes are independent.
:::

### Covariance and correlation

We earlier showed that if $x$ is a random variable, we can take the
expected value of any function of $x$.  In addition, when $x$ and 
$y$ are random variables with a well-defined joint distribution, 
we can take the expected value of any function of $x$ and $y$.

When $x$ and $y$ are both discrete:
  $$E(g(x,y)) = \sum_{a \in S_x} \sum_{b \in S_y} g(a,b)\Pr( x=a \cap y = b)$$
That is, we add up $g(x,y)$ across all possible values for the pair $(x,y)$
with each value weighted by its probability.

::: fyi
When $x$ and $y$ are both continuous:
  $$E(g(x,y)) = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} g(a,b)f_{x,y}(a,b)dadb$$
Again, this looks similar to the formula for the discrete case,
but uses an integral instead of a sum.
:::

As with a single random variable, you can take the expected value inside
a linear function:
  $$E(ax + by + c) = aE(x) + bE(y) + c$$
but not inside most other functions.  For example:
  $$E(xy) \neq E(x)E(y)$$
  $$E(x/y) \neq E(x)/E(y)$$
etc.

::: example
**Multiple bets in roulette**

Suppose we bet \$100 on red and \$10 on 14. Our net payout will be:
  $$w_{total} = 100*w_{red} + 10*w_{14}$$
which has expected value:
  \begin{align}
    E(w_{total}) &= E(100 w_{red} + 10 w_{14}) \\
      &= 100 \, \underbrace{E(w_{red})}_{\approx -0.027} + 10 \, \underbrace{E(w_{14})}_{\approx -0.027} \\
      &\approx -3 
  \end{align}
That is we expect this betting strategy to lose an average of 
about \$3 per game.
:::

The ***covariance*** of two random variables $x$ and $y$ 
is defined as:
  $$\sigma_{xy} = cov(x,y) = E[(x-E(x))*(y-E(y))]$$
and their ***correlation*** is defined as:
  $$\rho_{xy} = corr(x,y) = \frac{cov(x,y)}{\sqrt{var(x)var(y)}} = \frac{\sigma_{xy}}{\sigma_x\sigma_y}$$
Both the covariance and correlation are measures of how $x$ and $y$ tend to 
move together.  

- When the covariance or correlation is *positive*, then that means that
  $x$ and $y$ tend to move in the *same* direction. When $x$ is high, $y$ is
  typically high, and when $x$ is low, $y$ is typically low.
- When the covariance or correlation is *negative*, then that means that
  $x$ and $y$ tend to move in *opposite* directions. When $x$ is high, $y$ is
  typically low, and when $x$ is low, $y$ is typically high.
- When the covariance or correlation is *zero* or close to zero, 
  then that means that $x$ and $y$ tend *not* to move together.
- Since the standard deviations $\sigma_x$ and $\sigma_y$ are always[^3]
  positive, the covariance and correlation always have the same sign.
- When $x$ and $y$ are independent, their covariance and correlation
  are both exactly zero.  
  - However, it does not go the other way around.  There are many
    pairs of random variables that have a correlation of zero but
    are not independent.
- The covariance always lies somewhere between $-\sigma_x\sigma_y$ and
  $\sigma_x\sigma_y$, and so the correlation always lies between 
  $-1$ and $1$.
  
[^3]: More precisely, one or both of $\sigma_x$ and $\sigma_y$ could be zero.
In that case the covariance will also be zero, and the correlation will be 
undefined (since it is zero divided by zero).

::: example
**Covariance and correlation in roulettte**

The covariance of $w_{red}$ and $w_{14}$ is:
  \begin{align}
    cov(w_{red},w_{14}) &= \begin{aligned}[t]
        & (1-\underbrace{E(w_{red})}_{\approx -0.027})(35-\underbrace{E(w_{14})}_{\approx -0.027})\underbrace{f_{red,14}(1,35)}_{1/37}\\
        &+ (1-\underbrace{E(w_{red})}_{\approx -0.027})(-1-\underbrace{E(w_{14})}_{\approx -0.027})\underbrace{f_{red,14}(1,-1)}_{17/37} \\ 
        &+ (-1-\underbrace{E(w_{red})}_{\approx -0.027})(-1-\underbrace{E(w_{14})}_{\approx -0.027})\underbrace{f_{red,14}(-1,-1)}_{19/37} \\
        \end{aligned} \\
      &\approx 0.999 
    \end{align}
and its correlation is:
  \begin{align}
    corr(w_{red},w_{14}) 
    &= \frac{cov(w_{red},w_{14})}{\sqrt{var(w_{red})*var(w_{14})}} \\
     &\approx \frac{0.999}{\sqrt{1.0*34.1}} \\
     &\approx 0.17
  \end{align}
:::

The covariance is the expected value of a product, and the expected
value is a sum, which implies several convenient properties:

- The covariance can be written:
  $$cov(x,y) = E(xy) - E(x)E(y)$$
- Covariances of sums can be written:
  \begin{align}
    cov(ax+by+c, dx+ey+f) &= 
    \begin{aligned}[t]
      & ad \, var(x) + be \, var(y) \\
      &+ (bd + ae) \, cov(x,y) \\
    \end{aligned}
  \end{align}
- The variance of a random variable is its covariance with itself:
  $$cov(x,x) = var(x)$$
  
- The variance of a sum can be written:
  $$var(ax+by+c) = a^2 \, var(x) + b^2 \, var(y) + 2ab \, cov(x,y)$$ 

I will occasionally make use of these properties.

## Data and the data generating process

Suppose we have a data set. We would like to use that data set to learn
something about the mechanisms by which the data set was generated.
This process of learning from data is statistical analysis.

The basic idea of statistical analysis is that we will 

- Treat our data as the outcome of a random process called 
  the data generating process or "DGP"
- Create a probabilistic model of the DGP
  - This model typically includes one or more unknown 
    features called parameters.
  - Both the data itself and any numbers (statistics) calculated from that 
    data can be considered random variables whose probability distribution
    could be derived from the DGP *if we knew the DGP*.
- Construct statistics to estimate the unknown parameters of the DGP.
  - We will want to use statistics that have a high probability of 
    prividing provide accurate estimates. 

Given this overall strategy, we can talk about the details.

### A general framework

Let $D_n$ be our data set.  We think of $D_n$ as a set of random variables 
with unknown joint distribution $P_D$.  This joint distribution
is called the ***data generating process*** for $D_n$. The exact DGP
is assumed to be unknown, but we usually have at least some information 
about it.

In this chapter we will assume that $D_n = (x_1,x_2,\ldots,x_n)$ 
is a data set with one variable and $n$ observations.  We 
use $x_i$ to refer to an arbitrary observation $i$.

::: example
Returning to our roulette example, suppose our data provides
the result of 3 independent games of roulette.  Let $b_i$ 
be the outcome in game $i$, and let $x_i$ be the result of 
a bet on red:
  $$x_i = I(b_i \in RED) = \begin{cases} 1 & b_i \in RED \\ 0 & b_i \notin RED \\ \end{cases}$$
Then $D_n = (x_1,x_2,x_3)$. For example, if red loses the first
two games and wins the third game we have $D_n = (0,0,1)$.
:::

We have some ***statistic*** $s =s(D_n)$, i.e., a number that is 
calculated from the data.

  - Since the data is observed/known, the value of the statistic
    is observed/known.
  - Since the elements of $D_n$ are random variables, $s$ is also 
    a random variable with a well-defined (but unknown) probability
    distribution that depends on the unknown DGP.

::: example
In our roulette example, the total number of wins is:
  $$s = x_1 + x_2 + x_3$$
Since this is a number calculated from our data, it is a statistic.
:::

Often we are interested in some ***parameter*** $\theta = \theta(P_D)$ that 
describes some aspect of the DGP.  
  
  - Since the exact DGP is unknown, the exact value of $\theta$ is also
    unknown. 

::: example
In previous chapters, I asked you to assume that the roulette wheel
was *fair*, meaning that all outcomes were equally likely.  This 
allowed us to calculate the exact probability of red winning. But 
that is not possible in every application of probability:

- Maybe the roulette wheel isn't actually fair.
- Maybe the probability of a given event is actually quite 
  difficult to calculate exactly.

In either of these cases, it makes more sense to treat the
probability of winning as an unknown parameter:
  $$\theta = \Pr(x_i = 1)$$
Once we know this parameter, we can calculate the exact 
probability distribution of our data.

This calculation is time-consuming and not particularly informative,
but here is what it looks like.  The probability of observing 
a particular value of $D_n$ is:
  $$\Pr(D_n) = \theta^{s(D_n)}(1-\theta)^{3-s(D_n)}$$
where $s(D_n)=x_1+x_2+x_3$.
:::

We may use our statistic $s$ to tell us something about the value
of $\theta$:

  - Estimation: we may use $s$ as a best guess or ***estimate*** of 
    the true value of $\theta$.
  - Inference: we may use $s$ to infer whether a particular value
    of $\theta$ is plausible.

::: example
In our roulette example, a natural guess of the probability of red 
winning is the number of times we observe it winning.  That is,
if red wins about half of the time, we guess that it has about
a 50\% probability of winning. 

Alternatively, suppose we play 100 games of roulette and observe that red 
never wins (or always wins).  We might suspect that the casino is not 
running a fair table!
:::

In this chapter we will focus on estimation.  We will cover statistical
inference in a later chapter.

### Simple random sampling

In order to model the data generating process, we need to
model the entire joint distribution of $D_n$.  This
means:

- The probability distribution of each $x_i$
- The relationship between each of the $x_i$'s

Fortunately, we often can simplify this joint distribution
quite a bit by assuming that $D_n$ 
is ***independent and identically distributed*** (IID) 
or a ***simple random sample*** from a large ***population***.

A simple random sample has two features:

1. Independent: Each $x_i$ is independent of the others.
2. Identically distributed: Each $x_i$ comes from the same (unknown)
  probability distribution.

The reason we call this "independent and identically distributed"
is hopefully obvious, but what does it mean to say we have a 
"random sample" from a "population"? Well, one simple way of 
generating an IID sample is to:

1. Define the population of interest, for example all Canadian 
  residents.
2. Use some purely random mechanism to choose a small subset of cases
  from this population.
   - The subset is called our ***sample***
   - "Purely random" here means some mechanism like a coin flip
     or a computer's random number generator.
   - As a technical matter, the assumption of independence requires
      that we sample *with replacement*. This means we allow
      for the possibility that we sample the same case more than once.
      In practice this doesn't matter as long as the sample is small 
      relative to the population.
3. Collect data from every case in our sample.

It will turn out that a moderately-sized random sample provides 
surprisingly accurate information on the underlying population.

#### Sample selection and representativeness

In the real world, a simple random is quite difficult to collect
from humans. Even if we are able to randomly select cases, we often
run into the following problems:

- ***Nonresponse*** occurs when a sampled individual does not provide
  the requested information:
  - ***Survey-level*** nonresponse occurs when the sampled individual does not
    answer any questions. This can occur if the sampled individual cannot
    be found, refuses to answer, or cannot answer (for example, is
    incapacitated due to illness or disability).
  - ***Item-level*** nonresponse occurs when the sampled individual does 
    not answer a particular question.  This can occur if the respondent
    refuses to answer, or the question is not applicable or has no
    valid answer.
- ***Censoring*** occurs when a particular quantity of interest cannot be
  observed for a particular case.  Censored outcomes are extremely common
  in economics, for example:
    - A classic example of censoring is the market wage for individuals 
      who are not currently employed. 
    - In supply/demand analysis, we only observe quantity supplied and
      quantity demanded at the current market price.
      
Each of these data problems affect whether our sample can be interpreted
as ***representing*** the population we care about. There are two basic
solutions to these problems:

- Imputation: we assume values for all missing quantities. For example,
  we might assume that the wage of each non-employed worker is equal
  to the average wage among employed workers with similar 
  characteristics.
- Redefine the population: redefine the population so that our data
  can be correctly interpreted as a random sample from that population.
  For example, instead of having a random sample of *Canadians*, we can
  interpret our data as a random sample of 
  *Canadians who would answer these questions if asked*. 
  
This is not an issue that has a purely technical solution, but requires
careful thought instead.  If we are imputing values, do we believe that
our imputation method is reasonable?  If we are redefining the population,
is that population one we care about?

### Other sampling models

Not all useful data sets come from a simple random sample. For example:

- Some sample designs can be treated as if they were from a simple 
  random sample, or can be handled with minor modifications on
  the techniques used for simple random samples:
  - A ***stratified sample*** is gathered by dividing the population into
    strata based on some observable characteristics, and then randomly
    sampling a predetermined number of cases within each strata. 
      - Most professional surveys are constructed from stratified samples 
        rather than random samples.
      - Stratified sampling is often combined with *oversampling* of 
        some smaller strata. For example, the Labour Force Survey 
        oversamples residents of Prince Edward Island because a
        national random sample would not catch enough PEI residents to
        accurately measure PIE's unemployment rate.
  - A ***cluster sample*** is gathered by dividing the population
    into ***clusters***, randomly selecting some of these clusters, and
    sampling cases within the cluster.  
      - Educational data sets are often gathered this way: we pick a random 
        sample of schools, and then collect data from each student 
        within those schools.
  - A ***census*** gathers data on every case in the population. 
    - For example, we might have data on all 50 US states, or all 
      10 Canadian provinces, or all of the countries of the world. 
    - Data from administrative sources such as tax records or 
      school records often cover the entire population of interest as well. 
    - We typically interpret a census as a random sample from a hypothetical
      population of possible cases.
- Most macroeconomic data are ***time series***; that is they are observations
  of a particular quantity at regularly-spaced points in time.
  Time series have two features that are inconsistent with the random 
  sampling assumption:
    - They usually have clear time trends.  For example, Canada's real 
      GDP has been steadily growing for as long as we have observed it.
      This means that 2010 GDP is drawn from a distribution with a higher
      expected value than the distribution for 1910 GDP.
    - They usually exhibit what is called autocorrelation. Shocks to
      the economy that affect this year's GDP are likely to have 
      a similar (if smaller) effect on next year's GDP.  So the time periods
      close together are more closely related than time periods that 
      are far apart, even after we have accounted for the time trend.

  Time series data sometimes require more advanced techniques
  than we will learn in this class.
- A ***convenience sample*** is gathered by whatever method is convenient.
  - For example, we might gather a survey from people who walk by,
    or we might recruit our friends to participate in the survey.

  Convenience samples are the worst-case scenario; in many cases they
  simply aren't usable for accurate statistical analysis.
 
Many data sets combine several of these elements.  For example,
Canada's unemployment rate is calculated using data from the 
Labour Force Survey (LFS). The LFS is built from a stratified 
sample of the civilian non-institutionalized working-age population 
of Canada. There is also some clustering: the LFS will typically
interview whole households, and will do some geographic clustering
to save on travel costs. The LFS is gathered monthly, and the
resulting unemployment rate is a time series.

